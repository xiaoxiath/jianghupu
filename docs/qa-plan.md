# 🧪 《江湖残卷》测试与质量保证计划 (QA Plan)

---

## 1. 质量目标

- **功能正确性**: 所有核心功能（战斗、养成、探索等）符合设计预期。
- **稳定性**: 游戏在长时间运行下不崩溃，无内存泄漏。
- **体验流畅性**: AI 生成文本无明显延迟，CLI 交互响应迅速。
- **数据一致性**: 存档、读档、传承系统数据准确无误。

---

## 2. 测试策略

### 2.1. 测试层级

- **单元测试 (Unit Tests)**:
    - **工具**: `Vitest`
    - **范围**: 针对独立的、无副作用的纯函数。例如：战斗伤害计算、属性加成公式、随机数生成器。
    - **目标**: 保证底层逻辑的正确性。

- **集成测试 (Integration Tests)**:
    - **工具**: `Vitest` + `Prisma Test Environment`
    - **范围**: 测试多个模块协同工作的场景。例如：战斗流程（`combat.ts` + `state.ts`）、AI 叙事生成（`aiBard.ts` + `sceneManager.ts`）。
    - **目标**: 确保模块间的接口与数据流正确。

- **端到端测试 (End-to-End Tests)**:
    - **工具**: 自定义脚本，模拟用户输入。
    - **范围**: 模拟完整的游戏会话，从创建角色到死亡传承。
    - **目标**: 验证整个游戏循环的正确性和体验。

- **手动测试 (Manual Testing)**:
    - **范围**: 探索性测试、体验性测试、对 AI 生成内容的感性评估。
    - **目标**: 发现自动化测试难以覆盖的缺陷，评估游戏趣味性。

### 2.2. 自动化

- **持续集成 (CI)**:
    - **工具**: GitHub Actions
    - **流程**:
        1.  代码 `push` 到 `main` 或 `develop` 分支时触发。
        2.  运行 `lint` 和 `prettier` 检查。
        3.  运行所有单元测试和集成测试。
        4.  生成测试覆盖率报告。
        5.  （可选）构建可执行文件。
- **测试覆盖率**:
    - **工具**: `Vitest Coverage`
    - **目标**: 核心模块（core, systems）覆盖率 > 85%。

---

## 3. Bug 管理流程

### 3.1. Bug 生命周期

`发现 (New)` -> `确认 (Open)` -> `处理中 (In Progress)` -> `待验证 (Resolved)` -> `关闭 (Closed)` / `重新打开 (Reopened)`

### 3.2. Bug 报告模板

- **标题**: 简明扼要地描述问题。
- **复现步骤**: 清晰、可操作的步骤。
- **期望结果**: 按照设计，应该发生什么。
- **实际结果**: 实际发生了什么。
- **环境信息**: 游戏版本、操作系统。
- **截图/日志**: 提供必要的附件。

### 3.3. 优先级定义

| 优先级 | 描述 | 修复时限 |
|---|---|---|
| **P0 - Blocker** | 阻断核心流程、导致崩溃或数据丢失。 | 立即修复 |
| **P1 - Critical** | 严重影响功能或体验，但有临时绕过方案。 | 24 小时内 |
| **P2 - Major** | 一般性功能缺陷，不影响主流程。 | 1 周内 |
| **P3 - Minor** | UI/文本错误、体验优化点。 | 下一版本 |

---

## 4. 重点测试模块

- **战斗系统**: 平衡性、技能效果、Combo 触发。
- **AI 说书人**: 生成内容的质量、风格一致性、JSON 格式稳定性。
- **存档/传承系统**: 数据完整性、跨版本兼容性。
- **世界演化**: NPC 和势力的长期演化是否符合预期，是否会出现意外的崩溃。